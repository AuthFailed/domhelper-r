<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Авторизация</title>
    <style>
        /* ... existing styles ... */
    </style>
    <script type="text/javascript">
        function onTelegramAuth(user) {
            if (user && user.id) {
                // Send message directly to opener window
                if (window.opener) {
                    const authData = {
                        type: 'telegram_auth',
                        userId: user.id,
                        timestamp: Date.now()
                    };

                    // Try to send to extension popup
                    window.opener.postMessage(authData, '*');

                    // Also store in localStorage as backup
                    localStorage.setItem('telegram_auth', JSON.stringify(authData));

                    // Close window after short delay to ensure message is sent
                    setTimeout(() => window.close(), 500);
                }
            }
        }

        // Check for stored auth on page load
        document.addEventListener('DOMContentLoaded', () => {
            const storedAuth = localStorage.getItem('telegram_auth');
            if (storedAuth && window.opener) {
                try {
                    window.opener.postMessage(JSON.parse(storedAuth), '*');
                    localStorage.removeItem('telegram_auth');
                } catch (e) {
                    console.error('Error sending stored auth:', e);
                }
            }
        });
    </script>
</head>
<body>
<div class="auth-container">
    <h1>Авторизация</h1>
    <script async
            src="https://telegram.org/js/telegram-widget.js?22"
            data-telegram-login="helper_authorization_bot"
            data-size="large"
            data-onauth="onTelegramAuth(user)"
            data-request-access="write">
    </script>
</div>
</body>
</html>